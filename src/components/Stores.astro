---
import tienda160 from '../assets/images/tienda_160.jpg?url';
import tienda440 from '../assets/images/tienda_440.jpg?url';

const stores = [
  {
    name: "Tienda Independencia 1",
    address: "Calle Las Prensas 160, Independencia, Lima",
    locationUrl: "https://maps.google.com/?q=Calle+Las+Prensas+160+Independencia+Lima+Peru",
    images: [
      tienda160,
      tienda440
    ]
  },
  {
    name: "Tienda Independencia 2", 
    address: "Calle Las Prensas 440, Independencia, Lima",
    locationUrl: "https://maps.google.com/?q=Calle+Las+Prensas+440+Independencia+Lima+Peru",
    images: [
      tienda440,
      tienda160
    ]
  },
  {
    name: "Tienda Arequipa",
    address: "Calle 22 de Agosto, Arequipa", 
    locationUrl: "https://maps.google.com/?q=Calle+22+de+Agosto+Arequipa+Peru",
    images: [
      tienda160,
      tienda440
    ]
  }
];
---

<section id="tiendas" class="py-16 bg-gray-50">
  <div class="max-w-6xl mx-auto px-4">
    <h2 class="text-center text-4xl text-slate-700 mb-12 font-bold">Nuestras Tiendas</h2>
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
      {stores.map((store, index) => (
        <div class="relative rounded-xl overflow-hidden shadow-lg shadow-black/20 transition-all duration-300 hover:-translate-y-2 hover:shadow-xl hover:shadow-black/25 group" key={index}>
          <!-- Full card image background -->
          <div class="relative h-[540px] md:h-[448px] overflow-hidden">
            <div class="flex transition-transform duration-500 h-full" id={`carousel-${index}`}>
              {store.images.map((image, imgIndex) => (
                <div class="min-w-full h-full flex-shrink-0" key={imgIndex}>
                  <img src={image} alt={`${store.name} - Foto ${imgIndex + 1}`} class="w-full h-full object-cover block transition-transform duration-300 group-hover:scale-105" />
                </div>
              ))}
            </div>
            
            <!-- Gradient overlay for text -->
            <div class="absolute inset-0 bg-gradient-to-t from-black/80 via-black/40 to-transparent"></div>
            
            <!-- Content over image -->
            <div class="absolute bottom-0 left-0 right-0 p-6 text-white z-10">
              <h3 class="text-xl font-bold mb-2 drop-shadow-lg">{store.name}</h3>
              <p class="text-white/90 mb-4 leading-relaxed drop-shadow">{store.address}</p>
              <a href={store.locationUrl} target="_blank" rel="noopener noreferrer" class="inline-flex items-center gap-2 bg-white/20 backdrop-blur-sm text-white px-4 py-2 rounded-full font-medium transition-all duration-300 hover:bg-white/30 hover:scale-105 border border-white/20">
                üìç Ver ubicaci√≥n
              </a>
            </div>
            
            <!-- Carousel controls -->
            <button class="absolute top-1/2 -translate-y-1/2 left-2.5 bg-black/60 text-white border-none w-10 h-10 rounded-full text-xl cursor-pointer transition-colors duration-300 hover:bg-black/80 z-20 carousel-btn carousel-prev" data-carousel={`carousel-${index}`}>&#8249;</button>
            <button class="absolute top-1/2 -translate-y-1/2 right-2.5 bg-black/60 text-white border-none w-10 h-10 rounded-full text-xl cursor-pointer transition-colors duration-300 hover:bg-black/80 z-20 carousel-btn carousel-next" data-carousel={`carousel-${index}`}>&#8250;</button>
            <div class="absolute top-4 left-1/2 -translate-x-1/2 flex gap-2 z-20 carousel-dots">
              {store.images.map((_, imgIndex) => (
                <button class="w-2.5 h-2.5 rounded-full border-none bg-white/50 cursor-pointer transition-all duration-300 carousel-dot hover:bg-white/80" data-carousel={`carousel-${index}`} data-slide={imgIndex} key={imgIndex}></button>
              ))}
            </div>
          </div>
        </div>
      ))}
    </div>
  </div>
</section>

<!-- Carousel active dot styling -->
<style>
  .carousel-dot.active {
    background: white !important;
  }
  
  /* Mobile responsive adjustments */
  @media (max-width: 768px) {
    .grid-cols-1 {
      gap: 1.5rem;
    }
    
    .text-4xl {
      font-size: 2rem;
    }
    
    .mb-12 {
      margin-bottom: 2rem;
    }
    
    .h-64 {
      height: 12.5rem; /* 200px */
    }
    
    .p-6 {
      padding: 1rem;
    }
  }
  
  @media (max-width: 1024px) and (min-width: 769px) {
    .lg\\:grid-cols-3 {
      grid-template-columns: repeat(2, 1fr);
    }
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Get all carousel containers
    document.querySelectorAll('[id^="carousel-"]').forEach((carousel, carouselIndex) => {
      const prevBtn = document.querySelector(`[data-carousel="carousel-${carouselIndex}"].carousel-prev`);
      const nextBtn = document.querySelector(`[data-carousel="carousel-${carouselIndex}"].carousel-next`);
      const dots = document.querySelectorAll(`[data-carousel="carousel-${carouselIndex}"].carousel-dot`);
      const slides = carousel.children;
      
      let currentSlide = 0;
      
      function updateCarousel() {
        const translateX = -currentSlide * 100;
        carousel.style.transform = `translateX(${translateX}%)`;
        
        dots.forEach((dot, index) => {
          dot.classList.toggle('active', index === currentSlide);
        });
      }
      
      function nextSlide() {
        currentSlide = (currentSlide + 1) % slides.length;
        updateCarousel();
      }
      
      function prevSlide() {
        currentSlide = (currentSlide - 1 + slides.length) % slides.length;
        updateCarousel();
      }
      
      function goToSlide(slideIndex) {
        currentSlide = slideIndex;
        updateCarousel();
      }
      
      prevBtn?.addEventListener('click', prevSlide);
      nextBtn?.addEventListener('click', nextSlide);
      
      dots.forEach((dot, index) => {
        dot.addEventListener('click', () => goToSlide(index));
      });
      
      updateCarousel();
      
      // Auto-rotate every 4 seconds
      setInterval(nextSlide, 4000);
    });
  });
</script>